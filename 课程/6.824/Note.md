# Lecture 1: Introduction

## 1.1 分布式概述

### why分布式

1. 提高计算性能(increase capacity) → 通过多台计算机(cpu, 主存, 磁盘)并行
2. 容错(tolerate faults)
3. 很多实际上的需求就是需要连接物理上分隔的机器
4. 通过分布式运行代码, 来保证安全

### challenge

1. 有许多的并行执行 → 人脑很难理解并行
2. 分布式的组成太多, 错误情况复杂
3. 如何衡量分布式的性能 1000台机子能达到多少的性能



## 1.2 课程(lab)介绍

1. MapReduce
2. Raft算法实现容错
3. 基于Raft的KV
4. 分片式KV (并行加速)



## 1.3 分布式系统的抽象和实现工具（Abstraction and Implementation）

分布式系统的基础架构(infrastructure)

- 存储: 如何去构建一种多副本，容错的，高性能分布式存储实现
- 通信(网络)
- 计算

构建分布式系统需要对底层这些基础设施进行封装和抽象, 让用户使用接口时, 像是在使用非分布式的系统



### implement

**RPC**: Remote Procedure Call

**线程**: 用线程这个结构化的概念去简化并发操作

并发控制--**锁**

## 1.4 可扩展性（Scalability）

> 即为性能的拓展

理想的可拓展性: 两倍的机器 两倍的执行速度(一半的计算耗时)

另一种提升性能的方式: 重构系统, 优化算法, 但是更为耗时且expensive

- 比如我的网站在一个时刻突然爆火, 此时想要重构去优化已经来不及了, 想保证网站的可用只能购买更多服务器

## 1.5 可用性（Availability）

> 即为系统的容错

对于单计算机构建的系统, 通常是可靠的(计算机, os, 电源一般不会出错); 

但是多台计算机, 罕见的问题会被放大

- > 例如在我们的1000台计算机的集群中，总是有故障，要么是机器故障，要么是运行出错，要么是运行缓慢，要么是执行错误的任务。一个更常见的问题是网络，在一个有1000台计算机的网络中，会有大量的网络电缆和网络交换机，所以总是会有人踩着网线导致网线从接口掉出，或者交换机风扇故障导致交换机过热而不工作。在一个大规模分布式系统中，各个地方总是有一些小问题出现。所以大规模系统会将一些几乎不可能并且你不需要考虑的问题，变成一个持续不断的问题。

- 所以, 我们在设计时就要保证系统在出错之后能够屏蔽和掩盖错误

==可用性==(Availability): 在特定的故障范围内，系统仍然能够提供服务，系统仍然是可用的。如果出现了更多的故障，系统将不再可用。

- 比如构建了多副本系统

==可恢复性==(recoverability): 如果出现了问题，服务会停止工作，不再响应请求，之后有人来修复，并且在修复之后系统仍然可以正常运行，就像没有出现过问题一样。

- 这是一个**比可用性更弱**的需求，因为在出现故障到故障组件被修复期间，系统将会完全停止工作。但是修复之后，系统又可以完全正确的重新运行，所以可恢复性是一个重要的需求。

- 为了实现可恢复, 需要将系统数据进行backup, 以便之后恢复, 常用工具如下
  - 非易失存储（non-volatile storage，类似于硬盘）
  - 复制（replication）: 但是管理复制的副本, 使其状态同步较为复杂(lab2&3会涉及到)

## 1.6 一致性（Consistency）

> 假设构建了一套KV的分布式存储, 有两个操作, get和put
>
> put操作会将一个value存入一个key；get操作会取出key对应的value

对于分布式系统, 因为存在复制/缓存, 数据会存在于多个副本之中

- 加入初始时, AB机器维护了相同的KV表, 有<1, 100>
- 对机器A put<1, 200>, 但在此时, AB之间通信出错, B并没有收到put
- 之后get请求可能从A读, 得到200; 或是从B读, 得到100
  - 还有可能get一直从A读, 数据都是正确的, 直到某次A故障, 此时我们只保存了B中错误的100

### 强/弱一致

**强一致性**: get请求可以得到最近一次完成的put请求写入的值

**弱一致性**: 不保证get请求可以得到最近一次完成的put请求写入的值

强一致固然正确, 但是想要维护它需要带来很高的 用于同步的通信开销(不管put还是get都要同时读写所有副本, 并使用最新的数据)

- 在存储我们的副本的物理位置通常较远(异地副本), 如果保持强一致, 通信时延本身就很高, 大大拖慢系统速度

所以弱一致系统更为常用